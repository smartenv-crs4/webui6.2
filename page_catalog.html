<!DOCTYPE html>
<!--[if IE 8]>
<html lang="en" class="ie8"> <![endif]-->
<!--[if IE 9]>
<html lang="en" class="ie9"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en"> <!--<![endif]-->
<head>
    <title>Catalog Page - Cagliari Port 2020</title>

    <!-- Meta -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    
    <script type="text/javascript" src="assets/plugins/jquery/jquery.min.js"></script>
    <script type="text/javascript" src="assets/plugins/jquery/jquery-migrate.min.js"></script>
    <script type="text/javascript" src="assets/plugins/bootstrap/js/bootstrap.min.js"></script>
    <!-- JS Implementing Plugins -->
    
    <script type="text/javascript" src="assets/js/plugins/bootstrap-confirmation.min.js"></script>

    <!-- Favicon -->
    <link rel="shortcut icon" href="favicon.ico">

    <!-- Web Fonts -->
    <link rel='stylesheet' type='text/css'
          href='http://fonts.googleapis.com/css?family=Open+Sans:400,300,600&amp;subset=cyrillic,latin'>

    <!-- CSS Global Compulsory -->
    <link rel="stylesheet" href="assets/plugins/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/style.css">

    <!-- CSS Header and Footer -->
    <link rel="stylesheet" href="assets/css/headers/header-default.css">
    <link rel="stylesheet" href="assets/css/footers/footer-v1.css">

    <!-- CSS Implementing Plugins -->
    <link rel="stylesheet" href="assets/plugins/animate.css">
    <link rel="stylesheet" href="assets/plugins/line-icons/line-icons.css">
    <link rel="stylesheet" href="assets/plugins/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="assets/plugins/scrollbar/css/jquery.mCustomScrollbar.css">
    <link rel="stylesheet" href="assets/plugins/sky-forms-pro/skyforms/css/sky-forms.css">
    <link rel="stylesheet" href="assets/plugins/sky-forms-pro/skyforms/custom/custom-sky-forms.css">

    <!-- CSS Page Style -->
    <link rel="stylesheet" href="assets/css/pages/profile.css">
    <link rel="stylesheet" href="assets/css/pages/page_misc_sticky_footer.css">


    <!-- CSS Theme -->
    <link rel="stylesheet" href="assets/css/theme-skins/dark.css" id="style_color">
    <link rel="stylesheet" href="assets/css/theme-colors/dark-red.css">
    
    <link rel="stylesheet" href="assets/css/jquery.jgrowl.min.css">
    <script type="text/javascript" src="assets/js/plugins/jquery.jgrowl.min.js"></script>

    <!-- CSS Customization -->
    <link rel="stylesheet" href="assets/css/custom.css">
    <link rel="stylesheet" href="assets/css/custom_rfq.css">
    <style type="text/css">
        .giveMeEllipsis {
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-box-orient: vertical;
            -webkit-line-clamp: 5; /* number of lines to show */
            /*  line-height: 1;  fallback */
            max-height: 5; /* fallback */
        }

        .sidebar-showhide {
            max-width: 25%;
            float: left;
            display: flex;
            padding: 15px;
            padding-top: 0;
        }

        .autoexpand {
            width: auto;
            display: flex;
        }

        #pagination_container {
            display: block;
            margin-right: auto;
            margin-left: auto;
            max-width: 530px;
            width: 530px;
        }

        .media-s100 {
            width: 100px;
            height: 100px;
            margin-right: 10px;
        }
        
        
        
        .imnav {
          color: #ffffff;
          margin:o auto;
          opacity:0.6;
          display:none;
          position:absolute;
          top:0;
          left:0px;
          width:100%;
          height:100%;
      }
      
      .imnav > span {
        cursor: pointer;
      }

      .imgcon:hover .imnav{display:inline-block;}

      .control {
          float:left;
          height:100%;
          width:25%;
          opacity:0;              
          display:table; 
          table-layout:fixed;
      }

      .control:hover {
          opacity:0.6;          
      }
      
      .prim {
        left:0;    
      }

      .neim{
        right:0;
        position: absolute;        
      }
      .control > span{
        display:table-cell; 
        vertical-align:middle; 
        color:red; 
        font-size:30pt;
      }
      
      .neim > span{
        text-align: right;        
      }
      
      .prim > span{
        text-align: left;        
      }
      
      .th-gallery{
        float: left; 
        width:25px; 
        cursor:pointer; 
        height:25px; 
        margin:3px; 
        border: solid 1px #eeeeee";
      }


        
        
        
        
    </style>

</head>

<body>
<div class="wrapper">
    <!--=== Header ===-->
    <div id="header_p"></div>
    <!--=== End Header ===-->


    <!--=== Profile ===-->
    <div class="container content profile">
        <div class="row">
            <ul class="breadcrumb">
                <li><a href="/">Home</a></li>
                <li><a href="#" id="searchResultsAnchor" data-i18n="catalog.searchResults"></a></li>
                <li class="active" data-i18n="login.supplier"></li>
            </ul>
        </div>
        <div class="row">
            <!--Left Sidebar-->
            <div id="sidebar" class="sidebar-showhide" style="display: none;">

            </div>
            <!--End Left Sidebar-->

            <!-- Catalog Content -->
            <div class="autoexpand">

                <div class="profile-body margin-bottom-20">
                    <div id="supplier-info" style="position:relative">

                    </div>
                    <div class="tab-v1">
                        <ul class="nav nav-justified nav-tabs" id="tabContainer">
                            <li class="active"><a data-toggle="tab" href="#profile"
                            ><i class="fa fa-user"></i>&nbsp;<span data-i18n="profile.profile">Profile</span></a></li>
                            <li><a data-toggle="tab" href="#catalogTab"><i class="fa fa-book"></i>&nbsp;<span
                                    data-i18n="catalog.catalog">Catalog</span></a></li>
                            <li><a data-toggle="tab" href="#documentsReviews"><i class="fa fa-star-o"></i>&nbsp;<span
                                    data-i18n="profile.reviews">Reviews</span> </a>
                            </li>
                        </ul>

                        <div class="tab-content" id="tabBodyContainer">
                            <div id="responseBlock" class="alert alert-danger hidden"></div>
                            <div id="profile" class="profile-edit tab-pane fade in active"> <!-- PROFILE -->
                                <div class="profile-body" id="supplier-profile">

                                    <!--End Timeline-->

                                </div>
                            </div>
                            <div id="catalogTab" class="profile-edit tab-pane fade">
                                <div class="row ">
                                    <!--div class="col-md-4"><h2 class="heading-xs pull-left"><i
                                            class="fa fa-file fa-fw"></i> <span
                                            data-i18n="catalog.catalog"></span></h2>
                                    </div-->
                                    <div class="col-md-8">

                                        <!--.search-block form.page-search-form .checkbox  -->
                                        <ul class="list-inline clear-both">

                                            <li class="sort-list-btn">
                                                <div class="input-group">
                                                    <input id="inputSearchCatalog" type="text" class="form-control"
                                                           data-i18n="[placeholder]catalog.placeholder"
                                                           placeholder="">
                                                    <span class="input-group-btn">
                                                        <button id="btnSearchCatalog" class="btn-u" type="button"><i class="fa fa-search"></i> <span
                                                                data-i18n="catalog.search"></span></button>
                                                    </span>

                                                </div>

                                                <!--div class="btn-group row">
                                                    <div class="col-md-10" style="padding-right: 0px;">
                                                        <input class="form-control margin-bottom-10" name="code"
                                                               type="text">
                                                    </div>

                                                    <div class="col-md-2" style="padding-left: 0px;">
                                                        <button type="button" class="btn-u "><i class="fa fa-search"></i>
                                                            <span data-i18n="catalog.search"></span></button>


                                                    </div>
                                                </div-->
                                                <!--div class="row search-block">
                                                    <form action="" class="sky-form page-search-form"
                                                          style="margin-left: 15px;">
                                                        <div class="inline-group">
                                                            <label class="checkbox"><input type="checkbox"
                                                                                           name="checkbox-inline"
                                                                                           checked=""><i></i><span
                                                                    data-i18n="catalog.all"></span></label>
                                                            <label class="checkbox"><input type="checkbox"
                                                                                           name="checkbox-inline"><i></i><span
                                                                    data-i18n="catalog.incatalog"></span></label>
                                                        </div>
                                                    </form>


                                                </div-->
                                            </li>

                                        </ul>

                                    </div>

                                </div>
                                <div class="row">
                                    <!--Alert-->
                                    <div class="sm-margin-bottom-30 col-md-8">
                                        <div class="panel-heading-v2 overflow-h">

                                        </div>
                                        <div id="products_container" class="table-search-v2">

                                        </div>

                                        <div id="pagination_container" class="center-block">

                                        </div>

                                    </div>
                                    <!--End Alert-->
                                    <div id="files_container" class="col-md-4">


                                    </div>

                                </div><!--/end row-->

                            </div>

                            <div id="documentsReviews" class="profile-edit tab-pane fade">

                            </div>


                        </div>
                    </div>
                </div>


            </div>
            <!-- End Catalog Content -->

            <!--/container-->
            <!--=== End Profile ===-->
        </div>
    </div><!--/wrapper-->
    <!--=== Footer Version 1 ===-->
    <div id="footer_p"></div>
    <!--=== End Footer Version 1 ===-->


    <script id="productstable" type="text/x-handlebars-template">
      <!-- Modal -->
      <div class="modal fade" id="modalGallery" role="dialog">
        <div class="modal-dialog modal-lg">
        
          <!-- Modal content-->
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal">&times;</button>              
            </div>
            <div class="modal-body imgcon" >
              <div style="overflow:auto; text-align: center;" id="galleryContainer">
                <img src="#" id="galleryImg" style="max-width:100%; max-height:100%">
                
                <div class="imnav">
                  <span onclick="slidePic('prev')">
                    <div  class="prim control">
                      <span class="imcontr glyphicon glyphicon-chevron-left"></span>
                    </div>
                  </span>
                        
                  <span onclick="slidePic('next')">
                    <div class="neim control glyphicon .glyphicon-chevron-right">
                      <span class="right glyphicon glyphicon-chevron-right"></span>                
                    </div>
                  </span>
            
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
          </div>
          
        </div>
      </div>      
      
        <div class="panel panel-profile">
            <div class="panel-heading overflow-h">
                <h2 class="panel-title heading-sm pull-left"><i class="fa fa-shopping-bag"></i><span
                        data-i18n="catalog.products"></span>

                    {{#if isSupplier}}
               <span class="input-group-btn" style="margin-left: 20px;float:right">
                                                        <button class="btn-u btn-u-xs btn-u rounded pull-right"
                                                                type="button"
                                                                onclick="window.location='page_product_new.html'"><i
                                                                class="fa fa-plus-circle"></i> <span
                                                                data-i18n="buttons.add"></span></button>
                                                    </span>
                    {{/if}}
                </h2>


            </div>

            {{#if filtered}}
              <label data-i18n="catalog.resultsLabel"></label> "{{filtered}}" <button class="btn-u" onclick="getproducts(getproductsURL, 'productstable', '#products_container', null, null, null);" data-i18n="catalog.showAll"></button>
            {{/if}}
            <div class="panel-body margin-bottom-50">
                {{#each products}}
                <div class="media media-v2" data-pid="{{_id}}">
                    <span class="pull-left" href="#" style="max-width:120px">
                        <img class="media-s100 img-circle"
                             data-oldsrc="http://seidue.crs4.it:3015/{{trim _id}}/{{trim images.[0].name}}_o.jpg"
                             src="{{imgUrl.[0].url}}"
                             data-iid="{{imgUrl.[0].id}}"
                             onError="this.onerror=null;this.src='assets/img/team/img1-md.jpg'"
                             alt="" 
                             onclick="openGallery(this)"
                             style="cursor:pointer" >
                             <div class="center-block">
                               {{#each imgUrl}}
                                 <div class="th-gallery"  
                                       onclick="updateImgThumb(this)">
                                   <img src="{{this.url}}" style="max-width:100%; max-height:100%" data-iid="{{this.id}}">
                                 </div>
                               {{/each}}
                            </div>
                    </span>
                    <div class="media-body">
                        <div class="clearfix" style="overflow:hidden; ">
                            <h4 class="media-heading">
                                <strong style="display:block;"><a href="#">{{name}}</a></strong>
                            </h4>
                            {{#each categories}}
                            <h4>
                                <small data-i18n="categories.{{_id}}" style="display:block;"></small>                  
                            </h4>
                            {{/each}}
                        </div>

                        <p>
                        <div class="giveMeEllipsis blog-author-desc">{{description}}</div>
                        <a class="more" style="display:none" data-i18n="catalog.more"></a>
                        <a class="less" style="display:none" data-i18n="catalog.less"></a>
                        </p>

                        <ul class=" tags-v4 results-list pull-left">
                            {{#each tags}}
                            <li><a href="list.html?tags={{this}}">{{this}}</a></li>
                            {{/each}}
                        </ul>
                        <ul class="list-inline pull-right">
                            {{#if ../isSupplier}}
                            <li><a href="page_product_edit.html?pid={{_id}}"><i class="fa fa-edit"></i></a></li>
                            <li><a data-title="Do you want to remove '{{name}}' from your catalog?" 
                                   data-placement="top" href="#"
                                   data-on-confirm="deleteProduct"
                                   data-product-id="{{_id}}"  
                                   data-toggle="confirmation" 
                                   data-popout="true"><i class="fa fa-remove"></i></a></li>
                            {{/if}}
                            <!-- li><a href="#"><i class="expand-list rounded-x fa fa-globe"></i></a></li>
                            <li><a href="#"><i class="expand-list rounded-x fa fa-photo"></i></a></li>
                            <li><a href="#"><i class="expand-list rounded-x fa fa-star"></i></a></li -->
                        </ul>
                    </div>


                </div><!--/end media media v2-->
                <ul class="list-inline share-list">
                    <li><i class="fa fa-chevron-up"></i><span data-i18n="catalog.atleast"></span> {{minNum}}</li>
                    <li><i class="fa fa-chevron-down"></i><span data-i18n="catalog.atmost"></span> {{maxNum}}</li>
                    <li><i class="fa fa-calendar-o"></i><span data-i18n="catalog.deliveryIn"></span> {{deliveryIn}}
                      <span data-i18n="catalog.days"></span></li>
                    <li><i class="fa fa-inbox"></i><span data-i18n="catalog.availability"></span> {{availability}} <span data-i18n="rfq.{{unit}}"></span></li>
                        
                    <li><i class="fa fa-euro"></i><span> {{price}}€ per <span data-i18n="rfq.{{unit}}"></span></span>
                    </li>
                </ul>
                {{/each}}


            </div>
        </div>
        <script language="JavaScript">$(document).ready(function(){
            $(".giveMeEllipsis:truncated").siblings("a.more").show();})
        </script>
    </script>


    <script id="filetable" type="text/x-handlebars-template">
        <div class="md-margin-bottom-20">
            <div class="panel panel-profile no-bg">
                <div class="panel-heading overflow-h">
                    <h2 class="panel-title heading-sm pull-left"><i class="fa fa-file"></i><span
                            data-i18n="catalog.files"></span></h2>
                    {{#if isSupplier}}<a href="#"><i class="fa fa-upload pull-right"></i></a> {{/if}}
                </div>
                <div id="scrollbar2" class="panel-body no-padding mCustomScrollbar _mCS_3 mCS-autoHide"
                     data-mcs-theme="minimal-dark" style="position: relative; overflow: visible;">
                    <div id="mCSB_3" class="mCustomScrollBox mCS-minimal-dark mCSB_vertical mCSB_outside" tabindex="0">
                        <div id="mCSB_3_container" class="mCSB_container"
                             style="position: relative; top: 0px; left: 0px;"
                             dir="ltr">

                            {{#each files}}
                            <div class="profile-event">
                                <div class="date-formats">
                                    <i onclick="javascript:window.open('{{../url}}{{fid}}');"
                                       class="fa fa-file-pdf-o"></i>

                                </div>

                                <div class="overflow-h">
                                    <h3 class="heading-xs"><a href="{{../url}}{{fid}}"
                                                              target="_blank">{{filename}}</a>
                                    </h3>
                                    <p data-i18n="catalog.pdf"></p>
                                    {{#if ../isSupplier}}
                                    <i class="fa fa-remove"></i>
                                    {{/if}}
                                </div>
                            </div>
                            {{/each}}
                        </div>
                    </div>
                    <div id="mCSB_3_scrollbar_vertical"
                         class="mCSB_scrollTools mCSB_3_scrollbar mCS-minimal-dark mCSB_scrollTools_vertical"
                         style="display: block;">
                        <div class="mCSB_draggerContainer">
                            <div id="mCSB_3_dragger_vertical" class="mCSB_dragger"
                                 style="position: absolute; min-height: 50px; display: block; height: 168px; max-height: 286px; top: 0px;"
                                 oncontextmenu="return false;">
                                <div class="mCSB_dragger_bar" style="line-height: 50px;"></div>
                            </div>
                            <div class="mCSB_draggerRail"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </script>


    <script id="pagination_template" type="text/x-handlebars-template">


        <ul class="pagination">
            {{#paginate pagination type="first"}}
            {{#if disabled}}{{else}}
            <li class="hidden-xs hidden-sm"><a href="#"
                                               onclick="javascript:getproducts(getproductsURL, 'productstable', '#products_container', {{n}});"
                                               data-i18n="pagination.first"></a></li>
            {{/if}}
            {{/paginate}}
            {{#paginate pagination type="previous"}}
            {{#if disabled}}{{else}}
            <li><a href="#"
                   onclick="javascript:getproducts(getproductsURL, 'productstable', '#products_container', {{n}});">
                &lt;</a></li>
            {{/if}}
            {{/paginate}}
            {{#paginate pagination type="middle" limit="7"}}
            <li class="{{#if active}}active{{/if}} hidden-xs">
                <a href="#"
                   onclick="javascript:getproducts(getproductsURL, 'productstable', '#products_container', {{n}});">{{n}}</a>
            </li>
            {{/paginate}}
            {{#paginate pagination type="next"}}
            {{#if disabled}}{{else}}
            <li><a href="#"
                   onclick="javascript:getproducts(getproductsURL, 'productstable', '#products_container', {{n}});">
                &gt;</a></li>
            {{/if}}
            {{/paginate}}
            {{#paginate pagination type="last"}}
            {{#if disabled}}{{else}}
            <li class="hidden-xs hidden-sm"><a href="#"
                                               onclick="javascript:getproducts(getproductsURL, 'productstable', '#products_container', {{n}});"
                                               data-i18n="pagination.last"></a></li>
            {{/if}}
            {{/paginate}}
        </ul>
    </script>

    <script type="text/x-handlebars-template" id="supplier-info_template">
        <div class="blog-author " style="min-height: 110px;">
            {{#if logged}}
            <button class="btn-u " id="btn_rfq" type="button" style="float: right;"
                    onclick="javascript:window.location='page_rfq_new.html?supplierId={{_id}}&supplierName={{plusname}}'">
                <i class="fa fa-paper-plane"></i> <span data-i18n="rfq.sendRFQ"></span>
            </button>
            {{/if}}
            <img onError="this.onerror=null;this.src='assets/img/team/img1-md.jpg'" src="{{logo}}" alt="">
            <div class="blog-author-desc">
                <div class="overflow-h">
                    <h4>{{name}}</h4>

                </div>
                <p>{{address}}</p>
            </div>

            <div id="starBlock" style="position:absolute; top:0; left:0; margin:5px">
            </div>

        </div>
    </script>


    <script type="text/x-handlebars-template" id="supplier_favorite_template">
        {{#if isCustomer}}
        {{#if noFavorite}}
            <span style="cursor:pointer" data-toggle="tooltip" data-i18n="[title]publicProfile.addSupplier"
                  onclick="addToFavorite()">
              <span style="" class="yellow glyphicon glyphicon-star-empty" aria-hidden="true"></span>
            </span>
        {{else}}
            <span>
              <span style="" class="yellow glyphicon glyphicon-star" aria-hidden="true"></span>
            </span>
        {{/if}}
        {{/if}}
    </script>

    <script type="text/x-handlebars-template" id="full-star_template">
      <span class="pull-right" aria-label="Left Align">
        <span style="" class="yellow glyphicon glyphicon-star" aria-hidden="true"></span>
      </span>
    </script>


    <script type="text/x-handlebars-template" id="supplier-profile_template">
        <div class="profile-bio">
            <div>

                <p>{{description}}</p>

            </div>
        </div><!--/end row-->


        <hr>

        <!--Timeline-->
        <div class="panel panel-profile">
            <div class="panel-heading overflow-h">
                <h2 class="panel-title heading-sm pull-left"><i class="fa fa-briefcase"></i>
                    Certifications</h2>
                <a href="#"><i class="fa fa-cog pull-right"></i></a>
            </div>
            <div class="panel-body margin-bottom-40">
                <ul class="timeline-v2 timeline-me">
                  {{#each certifications}}
                    <li>
                        <time datetime="" class="cbp_tmtime"><span>{{name}}</span> <span>{{date}}</span>
                        </time>
                        <i class="cbp_tmicon rounded-x hidden-xs"></i>
                        <div class="cbp_tmlabel">
                            <!-- h2></h2 -->
                            <p>{{description}}</p>
                        </div>
                    </li>
                    {{/each}}                    
                </ul>
            </div>
        </div>
    </script>



    <script type="text/javascript" src="assets/plugins/smoothScroll.js"></script>
    <script type="text/javascript" src="assets/plugins/counter/waypoints.min.js"></script>
    <script type="text/javascript" src="assets/plugins/counter/jquery.counterup.min.js"></script>
    <script type="text/javascript" src="assets/plugins/sky-forms-pro/skyforms/js/jquery-ui.min.js"></script>
    <script type="text/javascript" src="assets/plugins/scrollbar/js/jquery.mCustomScrollbar.concat.min.js"></script>

    <!-- JS Translation -->
    <script src="assets/js/translations/translation.js"></script>
    <script type="text/javascript" src="assets/js/plugins/i18next.min.js"></script>
    <script src="assets/js/plugins/jquery-i18next.min.js"></script>

    <!-- JS Customization -->
    <script type="text/javascript" src="assets/js/sidebar.js"></script>
    <script type="text/javascript" src="assets/js/footer.js"></script>

    <!-- JS Page Level -->
    <script type="text/javascript" src="assets/js/app.js"></script>
    <script type="text/javascript" src="assets/js/plugins/datepicker.js"></script>
    <!--<script type="text/javascript" src="assets/js/plugins/style-switcher.js"></script>-->
    <script type="text/javascript" src="assets/js/common_header.js"></script>

    <script type="text/javascript" src="assets/js/plugins/handlebars.min.js"></script>

    <script type="text/javascript" src="assets/js/utils.js"></script>
    <script type="text/javascript" src="assets/js/custom.js"></script>
    <script type="text/javascript" src="assets/js/handlebars-paginate.js"></script>


    <script type="text/javascript">

        function getParameterByName(name, url) {
            if (!url) url = window.location.href;
            name = name.replace(/[\[\]]/g, "\\$&");
            var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
                    results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, " "));
        }

        var supId = getParameterByName("idSupplier"); //"57f5059fe8094b7137fa3efd";
        var getfilesURL = _brokerMsUrl + "files/attachments/" + supId;
        var getsupplierURL = _brokerMsUrl + "users/supplier/" + supId;
        var getproductsURL = _brokerMsUrl + "products?supplierId=" + supId;
        var getcutomerfavoritesURL = _brokerMsUrl + "users/favorites";
        //  getproductsURL = _brokerMsUrl + "products";

        var name = getParameterByName("name");
        var catName = decodeURI(getParameterByName("cat_name"));
        
        function getfiles(url, templateid, target) {
            $.get(url, function (data) {
                //console.log(data);

                var files = [];
               if(data.attachments)
               {
                 for(var i in data.attachments.files)
                 {
                   var d ={}                   
                   d.filename = data.attachments.files[i].name;
                   d.fid = data.attachments.files[i].id;
                   files.push(d);
                 }
               }

                var compiled = cacheCompile(templateid, {
                    files: files,
                    url: _brokerMsUrl + "files/",
                    isSupplier: currentSupplier
                });


                $(target).empty();
                $(target).html(compiled);
                $(target).localize();
            });
        }

        function getproducts(url, templateid, target, page, name, catName) {
            if (page) {
                if (url.indexOf("?") === -1)
                    url += "?page=" + page;
                else
                    url += "&page=" + page
            }
                 
                
            if(name && name != "null" && name.trim() != "")
            {                  
              if (url.indexOf("?") === -1)
                url += "?name=" + name;
              else
                url += "&name=" + name
            }
            
            
            
            
            
            
            $.get(url, function (data) {
                //console.log(data);

                var prods = data.docs; 
                
                var filtered = undefined;
                
                if(name && name != "null" && name.trim() != "")
                  filtered = name;
                                
/*
                if (name && name != "null")
                {                  
                  filtered = name;
                  prods = prods.filter(function (el) {                      
                    return (el.name.toLowerCase().indexOf(name.toLowerCase()) != -1 ||
                      el.description.toLowerCase().indexOf(name.toLowerCase()) != -1);
                  });
                }
*/                  

//                if (catName && catName != "null")
//                    prods = prods.filter(function (el) {
//                        return el.name.toLowerCase().indexOf(name.toLowerCase()) != -1;
//                    });
                               
                
                for (var i in prods) {
                    prods[i].imgUrl = [];
                    if (prods[i].images.length > 0 && prods[i].images[0] != null && prods[i].images[0].imageId != undefined) 
                    {
                        prods[i].imgUrl.push({"url" : _brokerMsUrl + "/files/" + prods[i].images[0].imageId + "?tag=t", "id": prods[i].images[0].imageId});                        
                        
                        for(var j = 1; j < prods[i].images.length; j++)
                        {
                          prods[i].imgUrl.push({"url": _brokerMsUrl + "/files/" + prods[i].images[j].imageId + "?tag=t", "id": prods[i].images[j].imageId});                          
                        }                        
                    }
                    else {
                        prods[i].imgUrl.push({"url": "assets/img/team/img1-md.jpg", id: ""});
                    }                    
                }           

                var compiled = cacheCompile(templateid, {
                    products: prods,
                    isSupplier: currentSupplier,
                    filtered: filtered                                        
                });
                $(target).empty();
                $(target).html(compiled);

                var pagination = cacheCompile("pagination_template", {
                    pagination: {
                        page: data.page,
                        pageCount: data.pages
                    }
                });


                var categories = [];
                for (var i = 0; i < prods.length; ++i) {
                    var cat = prods[i].categories;
                    if (cat)
                        for (var j = 0; j < cat.length; ++j) {                                                                              
                            var c = cat[j];
                            categories.push({
                                id: c._id,
                                name: c.name
                            });
                            
                            /*                            
                            if (c.level.liv == 3) {
                                categories.push({
                                    id: c._id,
                                    name: c.name[localStorage.lng]
                                });
                            }
                            */
                        }                        
                }
                for (var c = 0; c < categories.length; ++c) {
                    var cat = categories[c];
 
                    for (var l in cat.name) {
                        if (!translation[l].translation["categories"])
                            translation[l].translation["categories"] = {};
                        translation[l].translation["categories"][cat.id] = cat.name[l];
                    }
                }


                $("#pagination_container").empty();
                if (data.pages > 1)
                    $("#pagination_container").html(pagination);
                    
                  jQuery('[data-toggle=confirmation]').confirmation({
                    rootSelector: '[data-toggle=confirmation]',
                    // other options
                  });
                $(target).localize();
                $("ul.pagination").localize();
                $(target).trigger('onload');

            });
        }

        $('#products_container').bind("onload", function () {
            setTimeout(function () {
                $(".giveMeEllipsis:truncated").siblings("a.more").show();
                $(".more").click(showMore);
                $(".less").click(showLess);
            }, 200)

        });

        $("a[href=#catalogTab]").click(function () {
            getproducts(getproductsURL, 'productstable', '#products_container', null, name, catName);

        });

        function setsupplierfavoritestatus(url, templateid, target) {
            var obj = {};
            obj.isCustomer = false;

            if (sessionStorage.type == "customer") {
                obj.isCustomer = true;
                obj.noFavorite = true;

                var supList = [];

                jQuery.ajax({
                    url: url,
                    type: "GET",
                    contentType: "application/json; charset=utf-8",
                    async: false,
                    success: function (dataResp, textStatus, xhr) {
                        supList = dataResp;
                    },
                    error: function (xhr, status) {
                    },
                    beforeSend: function (xhr, settings) {
                        xhr.setRequestHeader('Authorization', 'Bearer ' + sessionStorage.token);
                    }
                });

                for (var i in supList) {
                    if (supList[i]["_id"] == supId) {
                        obj.noFavorite = false;
                        break;
                    }
                }

                var compiled = cacheCompile(templateid, obj);

                $(target).html(compiled);

                $(target).localize();
            }
        }
        
        function updateImgThumb(node)
        {
          var src = jQuery(node).find(":nth-child(1)").attr("src");
          jQuery(node).parent().parent().find(":nth-child(1)").first().attr("src", src);
        }
        
        function openGallery(node)
        {
          var src = jQuery(node).attr("src").replace("tag=t", "tag=o");
          jQuery("#galleryImg").hide();
          var spinner = document.createElement("span");
          spinner.className = "fa fa-spinner fa-spin";
          spinner.style.fontSize = "50pt";
          spinner.id = "gallerySpinner";
          jQuery("#galleryContainer").prepend(spinner);
                    
          jQuery("#galleryImg").off("load")
            .on("load", function(){
              jQuery("#galleryImg").show();
              jQuery("#gallerySpinner").remove();                            
            });                              
          
          jQuery("#galleryImg").attr("src", src);          
          
          if(!window.gallery) window.gallery = {};
          
          window.gallery.images = [];
          window.gallery.index = 0;
          var c = 0;
          jQuery(node).siblings().first().find("img").each(function(){
            var tsrc = this.src.replace("tag=t", "tag=o");
            window.gallery.images.push(tsrc);
            
            if(tsrc == src)
            {              
              window.gallery.index = c;              
            }
            c++;
          })          
          
          $('#modalGallery').modal('show'); 
          
        }
        
        function slidePic(dir)
        {
          var x;          
          if(dir == "next")        
            x = 1;          
          else
            x = -1;          
          var idx = (window.gallery.index + x) % window.gallery.images.length;
          if(idx < 0) idx = window.gallery.images.length - 1;
          
          jQuery("#galleryImg").hide();
          var spinner = document.createElement("span");
          spinner.className = "fa fa-spinner fa-spin";
          spinner.style.fontSize = "50pt";
          spinner.id = "gallerySpinner";
          jQuery("#galleryContainer").append(spinner);                    
          
          jQuery("#galleryImg").attr("src", window.gallery.images[idx]);
          window.gallery.index = idx;          
        }

        function getsupplierinfo(url, templateid, target, cb) {

            $.get(url, function (data) {

                //console.log(data);
                var values = data[0];
                var plusname = values.name.split(" ").join("+");
                values['plusname'] = plusname;
                values['logged'] = logged && (userType() == "customer");
                var compiled = cacheCompile(templateid, values);

                $(target).empty();
                $(target).html(compiled);

                $(target).localize();

                target = "#supplier-profile";
                templateid = "supplier-profile_template";

                compiled = cacheCompile(templateid, data[0]);

                $(target).empty();
                $(target).html(compiled);

                $(target).localize();

                if (cb !== undefined) {
                    cb();
                }

            });
        }
        function showMore(e) {
            var el = e.currentTarget;
            $(el).siblings(".blog-author-desc").removeClass("giveMeEllipsis");
            $(el).hide();
            $(el).siblings(".less").show();
        }

        function showLess(e) {
            var el = e.currentTarget;
            $(el).siblings(".blog-author-desc").addClass("giveMeEllipsis");
            $(el).hide();
            $(el).siblings(".more").show();
        }

        $.expr[':'].truncated = function (obj) {
            var element = $(obj);

            return (element[0].scrollHeight > (element.innerHeight() + 1)) || (element[0].scrollWidth > (element.innerWidth() + 1));
        };
        
        
        
        
        
        function deleteProduct(pid)
        {
          var pid = jQuery(this).data("product-id");                            
                                                  
          jQuery.ajax({
            url: _brokerMsUrl + "products/" + pid,            
            type: "DELETE",
            success: function(data){
              var box = jQuery("[data-pid=" + pid +"]");
              box.find(".th-gallery img").each(function(){
                var iid = jQuery(this).data("iid");                
                if(iid.trim() != "")
                {
                  removeImage(iid);              
                }
                            
              });                                          
              jQuery.jGrowl("OK", {theme:'bg-color-green', life: 5000});
              getproducts(getproductsURL, 'productstable', '#products_container', null, name, catName);
            },
            error: function(xhr)
            {
              var msg;
              try
              {
                msg = xhr.responseJSON.message;
              }
              catch(err)
              {
                msg = i18next.t("error.internal_server_error");
              }
              
              jQuery.jGrowl(msg, {theme:'bg-color-red', life: 5000});
              
              console.log("product " + pid + " doesn't removed")      
            },
            beforeSend: function(xhr, settings) 
            { 
              xhr.setRequestHeader('Authorization','Bearer ' + sessionStorage.token); 
            } 
          });              
          
        }

    </script>

    <script type="text/javascript">

        var currentSupplier = isSupplier() && supId == userId();
        var logged = false;
        jQuery(document).ready(function () {                    

            Handlebars.registerHelper('paginate', paginate);
            Handlebars.registerHelper('trim', function (s) {
                if (s == undefined) {
                    s = "";
                }

                return new Handlebars.SafeString(s.trim());
            });

            App.init();
            //App.initCounter();
            //App.initScrollBar();
            //Datepicker.initDatepicker();
            //StyleSwitcher.initStyleSwitcher();
            //   getConversations();


            if (window.sessionStorage && sessionStorage.token)
                logged = true;
            if (logged) {
                $("#sidebar").show();
            }

            var cbFav = function () {
                setsupplierfavoritestatus(getcutomerfavoritesURL, "supplier_favorite_template", "#starBlock");
            };


            getsupplierinfo(getsupplierURL, "supplier-info_template", "#supplier-info", cbFav);
            getfiles(getfilesURL, "filetable", '#files_container');
            var searchpage = getParameterByName('page');
            var id_category = getParameterByName('id_category');
            var cat_name = getParameterByName('cat_name');
            var type_search = getParameterByName('type_search');
            
            
            var searchListURL = "list.html?";
            if (name && name != "null") 
                searchListURL += "&name=" + name;
            if (searchpage && searchpage != "null")
                searchListURL += "&page=" + searchpage;
            if (id_category && id_category != "null")
                searchListURL += "&id_category=" + id_category;
            if (cat_name && cat_name != "null")
                searchListURL += "&cat_name=" + cat_name;
            if (type_search && type_search != "null")
                searchListURL += "&type_search=" + type_search;
            
            searchListURL = searchListURL.replace('?&', '?');
            
            $("#searchResultsAnchor").attr('href', searchListURL);

            $("body").localize();

        });

        function addToFavorite() {
            if (sessionStorage.token) {
                var data = {};
                data.supplier = supId;

                jQuery.ajax({
                    url: _brokerMsUrl + "users/actions/favorites",
                    type: "POST",
                    data: JSON.stringify(data),
                    dataType: "json",
                    contentType: "application/json; charset=utf-8",
                    success: function (dataResp, textStatus, xhr) {
                        var compiled = cacheCompile("full-star_template");
                        jQuery("#starBlock").empty();
                        jQuery("#starBlock").append(compiled);
                        jQuery("#starBlock").localize();
                        //jQuery.jGrowl("OK", {theme:'bg-color-green', life: 5000});
                    },
                    error: function (xhr, status) {
                        var msg;

                        try {
                            msg = xhr.responseJSON.message;
                        }
                        catch (err) {
                            msg = i18next.t("error.internal_server_error");
                        }

                        console.log(msg)
                    },
                    beforeSend: function (xhr, settings) {
                        xhr.setRequestHeader('Authorization', 'Bearer ' + sessionStorage.token);
                    }
                });
            }
        }
              
       jQuery("#btnSearchCatalog").click(function(){
          var name = jQuery("#inputSearchCatalog").val();
          getproducts(getproductsURL, 'productstable', '#products_container', null, name, catName);
          
       })

        var name = getParameterByName("name");

        if(name && name != "null")
        {          
          jQuery("a[href=#catalogTab]").trigger("click");
          jQuery("#catalogTab").trigger("click");
        }

    </script>
    <!--[if lt IE 9]>
    <script src="assets/plugins/respond.js"></script>
    <script src="assets/plugins/html5shiv.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="assets/plugins/sky-forms-pro/skyforms/js/sky-forms-ie8.js"></script>
    <![endif]-->

    <!--[if lt IE 10]>
    <script src="assets/plugins/sky-forms-pro/skyforms/js/jquery.placeholder.min.js"></script>
    <![endif]-->
</body>
</html>
